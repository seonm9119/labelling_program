services:
  labelling:
    build: .
    image: labelling_program:latest
    container_name: labelling
    ports:
      - "127.0.0.1:5000:5000"
    volumes:
      # 코드 변경 시 바로 반영
      - ./app.py:/app/app.py:ro
      - ./gunicorn.conf.py:/app/gunicorn.conf.py:ro
      - ./templates:/app/templates:ro
      - ./static:/app/static:ro
      - ./models:/app/models:ro
      - ./routes:/app/routes:ro
      # 업로드 폴더
      - ./uploads:/app/uploads
      # CLIP 모델 캐시
      - ~/.cache/clip:/root/.cache/clip
      # 호스트 파일시스템 마운트
      - /home:/home
      - /mnt:/mnt
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DEFAULT_DATA_PATH=/
    dns:
      - 8.8.8.8
      - 8.8.4.4
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    restart: unless-stopped
